**[ã€Šä»£ç éšæƒ³å½•ã€‹ç®—æ³•è§†é¢‘å…¬å¼€è¯¾](https://programmercarl.com/other/gongkaike.html)ï¼š[å•è°ƒæ ˆï¼Œåˆä¸€æ¬¡ç»å…¸æ¥è¢­ï¼ LeetCodeï¼š84.æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://www.bilibili.com/video/BV1Ns4y1o7uB/)ï¼Œç›¸ä¿¡ç»“åˆè§†é¢‘å†çœ‹æœ¬ç¯‡é¢˜è§£ï¼Œæ›´æœ‰åŠ©äºå¤§å®¶å¯¹æœ¬é¢˜çš„ç†è§£**ã€‚

## æ€è·¯

æœ¬é¢˜å’Œ[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)ï¼Œæ˜¯é¥ç›¸å‘¼åº”çš„ä¸¤é“é¢˜ç›®ï¼Œå»ºè®®éƒ½è¦ä»”ç»†åšä¸€åšï¼ŒåŸç†ä¸Šæœ‰å¾ˆå¤šç›¸åŒçš„åœ°æ–¹ï¼Œä½†ç»†èŠ‚ä¸Šåˆæœ‰å·®å¼‚ï¼Œæ›´å¯ä»¥åŠ æ·±å¯¹å•è°ƒæ ˆçš„ç†è§£ï¼

å…¶å®è¿™ä¸¤é“é¢˜ç›®å…ˆåšé‚£ä¸€é“éƒ½å¯ä»¥ï¼Œä½†æˆ‘å…ˆå†™çš„42.æ¥é›¨æ°´çš„é¢˜è§£ï¼Œæ‰€ä»¥å¦‚æœæ²¡åšè¿‡æ¥é›¨æ°´çš„è¯ï¼Œå»ºè®®å…ˆåšä¸€åšæ¥é›¨æ°´ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„é¢˜è§£ï¼š[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æš´åŠ›è§£æ³•çš„è§£æ³•ï¼š

### æš´åŠ›è§£æ³•

* CPP

```CPP
class Solution {
public:
    int largestRectangleArea(vector<int>& heights) {
        int sum = 0;
        for (int i = 0; i < heights.size(); i++) {
            int left = i;
            int right = i;
            for (; left >= 0; left--) {
                if (heights[left] < heights[i]) break;
            }
            for (; right < heights.size(); right++) {
                if (heights[right] < heights[i]) break;
            }
            int w = right - left - 1;
            int h = heights[i];
            sum = max(sum, w * h);
        }
        return sum;
    }
};
```

å¦‚ä¸Šä»£ç å¹¶ä¸èƒ½é€šè¿‡leetcodeï¼Œè¶…æ—¶äº†ï¼Œå› ä¸ºæ—¶é—´å¤æ‚åº¦æ˜¯$O(n^2)$ã€‚

### åŒæŒ‡é’ˆè§£æ³•

æœ¬é¢˜åŒæŒ‡é’ˆçš„å†™æ³•æ•´ä½“æ€è·¯å’Œ[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)æ˜¯ä¸€è‡´çš„ï¼Œä½†è¦æ¯”[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)éš¾ä¸€äº›ã€‚

éš¾å°±éš¾åœ¨æœ¬é¢˜è¦è®°å½•è®°å½•æ¯ä¸ªæŸ±å­ å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡ï¼Œè€Œä¸æ˜¯å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„é«˜åº¦ã€‚

æ‰€ä»¥éœ€è¦å¾ªç¯æŸ¥æ‰¾ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢åœ¨å¯»æ‰¾çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†whileï¼Œè¯¦ç»†è¯·çœ‹ä¸‹é¢æ³¨é‡Šï¼Œæ•´ç†æ€è·¯åœ¨é¢˜è§£ï¼š[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)ä¸­å·²ç»ä»‹ç»äº†ã€‚

* CPP

```CPP
class Solution {
public:
    int largestRectangleArea(vector<int>& heights) {
        vector<int> minLeftIndex(heights.size());
        vector<int> minRightIndex(heights.size());
        int size = heights.size();

        // è®°å½•æ¯ä¸ªæŸ±å­ å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
        minLeftIndex[0] = -1; // æ³¨æ„è¿™é‡Œåˆå§‹åŒ–ï¼Œé˜²æ­¢ä¸‹é¢whileæ­»å¾ªç¯
        for (int i = 1; i < size; i++) {
            int t = i - 1;
            // è¿™é‡Œä¸æ˜¯ç”¨ifï¼Œè€Œæ˜¯ä¸æ–­å‘å·¦å¯»æ‰¾çš„è¿‡ç¨‹
            while (t >= 0 && heights[t] >= heights[i]) t = minLeftIndex[t];
            minLeftIndex[i] = t;
        }
        // è®°å½•æ¯ä¸ªæŸ±å­ å³è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
        minRightIndex[size - 1] = size; // æ³¨æ„è¿™é‡Œåˆå§‹åŒ–ï¼Œé˜²æ­¢ä¸‹é¢whileæ­»å¾ªç¯
        for (int i = size - 2; i >= 0; i--) {
            int t = i + 1;
            // è¿™é‡Œä¸æ˜¯ç”¨ifï¼Œè€Œæ˜¯ä¸æ–­å‘å³å¯»æ‰¾çš„è¿‡ç¨‹
            while (t < size && heights[t] >= heights[i]) t = minRightIndex[t];
            minRightIndex[i] = t;
        }
        // æ±‚å’Œ
        int result = 0;
        for (int i = 0; i < size; i++) {
            int sum = heights[i] * (minRightIndex[i] - minLeftIndex[i] - 1);
            result = max(sum, result);
        }
        return result;
    }
};
```

### å•è°ƒæ ˆ

æœ¬åœ°å•è°ƒæ ˆçš„è§£æ³•å’Œæ¥é›¨æ°´çš„é¢˜ç›®æ˜¯é¥ç›¸å‘¼åº”çš„ã€‚

ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œ[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)æ˜¯æ‰¾æ¯ä¸ªæŸ±å­å·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªå¤§äºè¯¥æŸ±å­é«˜åº¦çš„æŸ±å­ï¼Œè€Œæœ¬é¢˜æ˜¯æ‰¾æ¯ä¸ªæŸ±å­å·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„æŸ±å­ã€‚

**è¿™é‡Œå°±æ¶‰åŠåˆ°äº†å•è°ƒæ ˆå¾ˆé‡è¦çš„æ€§è´¨ï¼Œå°±æ˜¯å•è°ƒæ ˆé‡Œçš„é¡ºåºï¼Œæ˜¯ä»å°åˆ°å¤§è¿˜æ˜¯ä»å¤§åˆ°å°**ã€‚

åœ¨é¢˜è§£[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)ä¸­æˆ‘è®²è§£äº†æ¥é›¨æ°´çš„å•è°ƒæ ˆä»æ ˆå¤´ï¼ˆå…ƒç´ ä»æ ˆå¤´å¼¹å‡ºï¼‰åˆ°æ ˆåº•çš„é¡ºåºåº”è¯¥æ˜¯ä»å°åˆ°å¤§çš„é¡ºåºã€‚

é‚£ä¹ˆå› ä¸ºæœ¬é¢˜æ˜¯è¦æ‰¾æ¯ä¸ªæŸ±å­å·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„æŸ±å­ï¼Œæ‰€ä»¥ä»æ ˆå¤´ï¼ˆå…ƒç´ ä»æ ˆå¤´å¼¹å‡ºï¼‰åˆ°æ ˆåº•çš„é¡ºåºåº”è¯¥æ˜¯ä»å¤§åˆ°å°çš„é¡ºåºï¼

æˆ‘æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚å›¾ï¼š

![image.png](https://pic.leetcode.cn/1693207694-rByDuW-image.png)

åªæœ‰æ ˆé‡Œä»å¤§åˆ°å°çš„é¡ºåºï¼Œæ‰èƒ½ä¿è¯æ ˆé¡¶å…ƒç´ æ‰¾åˆ°å·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªå°äºæ ˆé¡¶å…ƒç´ çš„æŸ±å­ã€‚

æ‰€ä»¥æœ¬é¢˜å•è°ƒæ ˆçš„é¡ºåºæ­£å¥½ä¸æ¥é›¨æ°´åè¿‡æ¥ã€‚

æ­¤æ—¶å¤§å®¶åº”è¯¥å¯ä»¥å‘ç°å…¶å®å°±æ˜¯**æ ˆé¡¶å’Œæ ˆé¡¶çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä»¥åŠè¦å…¥æ ˆçš„ä¸‰ä¸ªå…ƒç´ ç»„æˆäº†æˆ‘ä»¬è¦æ±‚æœ€å¤§é¢ç§¯çš„é«˜åº¦å’Œå®½åº¦**

ç†è§£è¿™ä¸€ç‚¹ï¼Œå¯¹å•è°ƒæ ˆå°±æŒæ¡çš„æ¯”è¾ƒåˆ°ä½äº†ã€‚

é™¤äº†æ ˆå†…å…ƒç´ é¡ºåºå’Œæ¥é›¨æ°´ä¸åŒï¼Œå‰©ä¸‹çš„é€»è¾‘å°±éƒ½å·®ä¸å¤šäº†ï¼Œåœ¨é¢˜è§£[42. æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)æˆ‘å·²ç»å¯¹å•è°ƒæ ˆçš„å„ä¸ªæ–¹é¢åšäº†è¯¦ç»†è®²è§£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

ä¸»è¦å°±æ˜¯åˆ†ææ¸…æ¥šå¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š

* æƒ…å†µä¸€ï¼šå½“å‰éå†çš„å…ƒç´ heights[i]å¤§äºæ ˆé¡¶å…ƒç´ heights[st.top()]çš„æƒ…å†µ
* æƒ…å†µäºŒï¼šå½“å‰éå†çš„å…ƒç´ heights[i]ç­‰äºæ ˆé¡¶å…ƒç´ heights[st.top()]çš„æƒ…å†µ
* æƒ…å†µä¸‰ï¼šå½“å‰éå†çš„å…ƒç´ heights[i]å°äºæ ˆé¡¶å…ƒç´ heights[st.top()]çš„æƒ…å†µ

C++ä»£ç å¦‚ä¸‹ï¼š

* CPP

```CPP
// ç‰ˆæœ¬ä¸€
class Solution {
public:
    int largestRectangleArea(vector<int>& heights) {
        int result = 0;
        stack<int> st;
        heights.insert(heights.begin(), 0); // æ•°ç»„å¤´éƒ¨åŠ å…¥å…ƒç´ 0
        heights.push_back(0); // æ•°ç»„å°¾éƒ¨åŠ å…¥å…ƒç´ 0
        st.push(0);

        // ç¬¬ä¸€ä¸ªå…ƒç´ å·²ç»å…¥æ ˆï¼Œä»ä¸‹æ ‡1å¼€å§‹
        for (int i = 1; i < heights.size(); i++) {
            if (heights[i] > heights[st.top()]) { // æƒ…å†µä¸€
                st.push(i);
            } else if (heights[i] == heights[st.top()]) { // æƒ…å†µäºŒ
                st.pop(); // è¿™ä¸ªå¯ä»¥åŠ ï¼Œå¯ä»¥ä¸åŠ ï¼Œæ•ˆæœä¸€æ ·ï¼Œæ€è·¯ä¸åŒ
                st.push(i);
            } else { // æƒ…å†µä¸‰
                while (!st.empty() && heights[i] < heights[st.top()]) { // æ³¨æ„æ˜¯while
                    int mid = st.top();
                    st.pop();
                    if (!st.empty()) {
                        int left = st.top();
                        int right = i;
                        int w = right - left - 1;
                        int h = heights[mid];
                        result = max(result, w * h);
                    }
                }
                st.push(i);
            }
        }
        return result;
    }
};

```

ç»†å¿ƒçš„å½•å‹ä¼šå‘ç°ï¼Œæˆ‘åœ¨ heightæ•°ç»„ä¸Šåï¼Œéƒ½åŠ äº†ä¸€ä¸ªå…ƒç´ 0ï¼Œ ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿ

é¦–å…ˆæ¥è¯´æœ«å°¾ä¸ºä»€ä¹ˆè¦åŠ å…ƒç´ 0ï¼Ÿ

å¦‚æœæ•°ç»„æœ¬èº«å°±æ˜¯å‡åºçš„ï¼Œä¾‹å¦‚[2,4,6,8]ï¼Œé‚£ä¹ˆå…¥æ ˆä¹‹å éƒ½æ˜¯å•è°ƒé€’å‡ï¼Œä¸€ç›´éƒ½æ²¡æœ‰èµ° æƒ…å†µä¸‰ è®¡ç®—ç»“æœçš„å“ªä¸€æ­¥ï¼Œæ‰€ä»¥æœ€åè¾“å‡ºçš„å°±æ˜¯0äº†ã€‚ å¦‚å›¾ï¼š

![image.png](https://pic.leetcode.cn/1693207713-rpGvvi-image.png)

é‚£ä¹ˆç»“å°¾åŠ ä¸€ä¸ª0ï¼Œå°±ä¼šè®©æ ˆé‡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œèµ°åˆ°æƒ…å†µä¸‰çš„é€»è¾‘ã€‚

å¼€å¤´ä¸ºä»€ä¹ˆè¦åŠ å…ƒç´ 0ï¼Ÿ

å¦‚æœæ•°ç»„æœ¬èº«æ˜¯é™åºçš„ï¼Œä¾‹å¦‚ [8,6,4,2]ï¼Œåœ¨ 8 å…¥æ ˆåï¼Œ6 å¼€å§‹ä¸8 è¿›è¡Œæ¯”è¾ƒï¼Œæ­¤æ—¶æˆ‘ä»¬å¾—åˆ° midï¼ˆ8ï¼‰ï¼Œrigtï¼ˆ6ï¼‰ï¼Œä½†æ˜¯å¾—ä¸åˆ° leftã€‚

ï¼ˆmidã€leftï¼Œright éƒ½æ˜¯å¯¹åº”ç‰ˆæœ¬ä¸€é‡Œçš„é€»è¾‘ï¼‰

å› ä¸º å°† 8 å¼¹å‡ºä¹‹åï¼Œæ ˆé‡Œæ²¡æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆä¸ºäº†é¿å…ç©ºæ ˆå–å€¼ï¼Œç›´æ¥è·³è¿‡äº†è®¡ç®—ç»“æœçš„é€»è¾‘ã€‚

ä¹‹ååˆå°†6 åŠ å…¥æ ˆï¼ˆæ­¤æ—¶8å·²ç»å¼¹å‡ºäº†ï¼‰ï¼Œç„¶å å°±æ˜¯ 4 ä¸ æ ˆå£å…ƒç´  8 è¿›è¡Œæ¯”è¾ƒï¼Œå‘¨è€Œå¤å§‹ï¼Œé‚£ä¹ˆè®¡ç®—çš„æœ€åç»“æœresutlå°±æ˜¯0ã€‚ å¦‚å›¾æ‰€ç¤ºï¼š

![image.png](https://pic.leetcode.cn/1693207728-GGwxFU-image.png)

æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ heightæ•°ç»„å‰åå„åŠ ä¸€ä¸ªå…ƒç´ 0ã€‚

ç‰ˆæœ¬ä¸€ä»£ç ç²¾ç®€ä¹‹åï¼š

* CPP

```CPP
// ç‰ˆæœ¬äºŒ
class Solution {
public:
    int largestRectangleArea(vector<int>& heights) {
        stack<int> st;
        heights.insert(heights.begin(), 0); // æ•°ç»„å¤´éƒ¨åŠ å…¥å…ƒç´ 0
        heights.push_back(0); // æ•°ç»„å°¾éƒ¨åŠ å…¥å…ƒç´ 0
        st.push(0);
        int result = 0;
        for (int i = 1; i < heights.size(); i++) {
            while (heights[i] < heights[st.top()]) {
                int mid = st.top();
                st.pop();
                int w = i - st.top() - 1;
                int h = heights[mid];
                result = max(result, w * h);
            }
            st.push(i);
        }
        return result;
    }
};
```

è¿™é‡Œæˆ‘ä¾ç„¶å»ºè®®å¤§å®¶æŒ‰éƒ¨å°±ç­æŠŠç‰ˆæœ¬ä¸€å†™å‡ºæ¥ï¼ŒæŠŠæƒ…å†µä¸€äºŒä¸‰åˆ†ææ¸…æ¥šï¼Œç„¶ååœ¨ç²¾ç®€ä»£ç åˆ°ç‰ˆæœ¬äºŒã€‚ ç›´æ¥çœ‹ç‰ˆæœ¬äºŒå®¹æ˜“å¿½ç•¥ç»†èŠ‚ï¼

## å…¶ä»–è¯­è¨€ç‰ˆæœ¬

* []

```java
// æš´åŠ›è§£æ³•ï¼š
class Solution {
    public int largestRectangleArea(int[] heights) {
        int length = heights.length;
        int[] minLeftIndex = new int [length];
        int[] minRightIndex = new int [length];
        // è®°å½•å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
        minLeftIndex[0] = -1 ;
        for (int i = 1; i < length; i++) {
            int t = i - 1;
            // è¿™é‡Œä¸æ˜¯ç”¨ifï¼Œè€Œæ˜¯ä¸æ–­å‘å³å¯»æ‰¾çš„è¿‡ç¨‹
            while (t >= 0 && heights[t] >= heights[i]) t = minLeftIndex[t];
            minLeftIndex[i] = t;
        }
        // è®°å½•æ¯ä¸ªæŸ±å­å³è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
        minRightIndex[length - 1] = length;
        for (int i = length - 2; i >= 0; i--) {
            int t = i + 1;
            while(t < length && heights[t] >= heights[i]) t = minRightIndex[t];
            minRightIndex[i] = t;
        }
        // æ±‚å’Œ
        int result = 0;
        for (int i = 0; i < length; i++) {
            int sum = heights[i] * (minRightIndex[i] - minLeftIndex[i] - 1);
            result = Math.max(sum, result);
        }
        return result;
    }
}

// å•è°ƒæ ˆ:
class Solution {
    int largestRectangleArea(int[] heights) {
        Stack<Integer> st = new Stack<Integer>();
        
        // æ•°ç»„æ‰©å®¹ï¼Œåœ¨å¤´å’Œå°¾å„åŠ å…¥ä¸€ä¸ªå…ƒç´ 
        int [] newHeights = new int[heights.length + 2];
        newHeights[0] = 0;
        newHeights[newHeights.length - 1] = 0;
        for (int index = 0; index < heights.length; index++){
            newHeights[index + 1] = heights[index];
        }

        heights = newHeights;
        
        st.push(0);
        int result = 0;
        // ç¬¬ä¸€ä¸ªå…ƒç´ å·²ç»å…¥æ ˆï¼Œä»ä¸‹æ ‡1å¼€å§‹
        for (int i = 1; i < heights.length; i++) {
            // æ³¨æ„heights[i] æ˜¯å’Œheights[st.top()] æ¯”è¾ƒ ï¼Œst.top()æ˜¯ä¸‹æ ‡
            if (heights[i] > heights[st.peek()]) {
                st.push(i);
            } else if (heights[i] == heights[st.peek()]) {
                st.pop(); // è¿™ä¸ªå¯ä»¥åŠ ï¼Œå¯ä»¥ä¸åŠ ï¼Œæ•ˆæœä¸€æ ·ï¼Œæ€è·¯ä¸åŒ
                st.push(i);
            } else {
                while (heights[i] < heights[st.peek()]) { // æ³¨æ„æ˜¯while
                    int mid = st.peek();
                    st.pop();
                    int left = st.peek();
                    int right = i;
                    int w = right - left - 1;
                    int h = heights[mid];
                    result = Math.max(result, w * h);
                }
                st.push(i);
            }
        }
        return result;
    }
}
```

* []

```python

# æš´åŠ›è§£æ³•ï¼ˆleetcodeè¶…æ—¶ï¼‰
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        # ä»å·¦å‘å³éå†ï¼šä»¥æ¯ä¸€æ ¹æŸ±å­ä¸ºä¸»å¿ƒéª¨ï¼ˆå½“å‰è½®æœ€é«˜çš„å‚ç…§ç‰©ï¼‰ï¼Œè¿­ä»£ç›´åˆ°æ‰¾åˆ°å·¦ä¾§å’Œå³ä¾§å„ç¬¬ä¸€ä¸ªçŸ®ä¸€çº§çš„æŸ±å­
        res = 0

        for i in range(len(heights)):
            left = i
            right = i
            # å‘å·¦ä¾§éå†ï¼šå¯»æ‰¾ç¬¬ä¸€ä¸ªçŸ®ä¸€çº§çš„æŸ±å­
            for _ in range(left, -1, -1):
                if heights[left] < heights[i]:
                    break
                left -= 1
            # å‘å³ä¾§éå†ï¼šå¯»æ‰¾ç¬¬ä¸€ä¸ªçŸ®ä¸€çº§çš„æŸ±å­
            for _ in range(right, len(heights)):
                if heights[right] < heights[i]:
                    break
                right += 1
                
            width = right - left - 1
            height = heights[i]
            res = max(res, width * height)

        return res

# åŒæŒ‡é’ˆ 
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        size = len(heights)
        # ä¸¤ä¸ªDPæ•°åˆ—å‚¨å­˜çš„å‡æ˜¯ä¸‹æ ‡index
        min_left_index = [0] * size
        min_right_index = [0] * size
        result = 0

        # è®°å½•æ¯ä¸ªæŸ±å­çš„å·¦ä¾§ç¬¬ä¸€ä¸ªçŸ®ä¸€çº§çš„æŸ±å­çš„ä¸‹æ ‡
        min_left_index[0] = -1  # åˆå§‹åŒ–é˜²æ­¢whileæ­»å¾ªç¯
        for i in range(1, size):
            # ä»¥å½“å‰æŸ±å­ä¸ºä¸»å¿ƒéª¨ï¼Œå‘å·¦è¿­ä»£å¯»æ‰¾æ¬¡çº§æŸ±å­
            temp = i - 1
            while temp >= 0 and heights[temp] >= heights[i]:
                # å½“å·¦ä¾§çš„æŸ±å­æŒç»­è¾ƒé«˜æ—¶ï¼Œå°è¯•è¿™ä¸ªé«˜æŸ±å­è‡ªå·±çš„æ¬¡çº§æŸ±å­ï¼ˆDP
                temp = min_left_index[temp]
            # å½“æ‰¾åˆ°å·¦ä¾§çŸ®ä¸€çº§çš„ç›®æ ‡æŸ±å­æ—¶
            min_left_index[i] = temp
        
        # è®°å½•æ¯ä¸ªæŸ±å­çš„å³ä¾§ç¬¬ä¸€ä¸ªçŸ®ä¸€çº§çš„æŸ±å­çš„ä¸‹æ ‡
        min_right_index[size-1] = size  # åˆå§‹åŒ–é˜²æ­¢whileæ­»å¾ªç¯
        for i in range(size-2, -1, -1):
            # ä»¥å½“å‰æŸ±å­ä¸ºä¸»å¿ƒéª¨ï¼Œå‘å³è¿­ä»£å¯»æ‰¾æ¬¡çº§æŸ±å­
            temp = i + 1
            while temp < size and heights[temp] >= heights[i]:
                # å½“å³ä¾§çš„æŸ±å­æŒç»­è¾ƒé«˜æ—¶ï¼Œå°è¯•è¿™ä¸ªé«˜æŸ±å­è‡ªå·±çš„æ¬¡çº§æŸ±å­ï¼ˆDP
                temp = min_right_index[temp]
            # å½“æ‰¾åˆ°å³ä¾§çŸ®ä¸€çº§çš„ç›®æ ‡æŸ±å­æ—¶
            min_right_index[i] = temp
        
        for i in range(size):
            area = heights[i] * (min_right_index[i] - min_left_index[i] - 1)
            result = max(area, result)
        
        return result

# å•è°ƒæ ˆ
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        # Monotonic Stack
        '''
        æ‰¾æ¯ä¸ªæŸ±å­å·¦å³ä¾§çš„ç¬¬ä¸€ä¸ªé«˜åº¦å€¼å°äºè¯¥æŸ±å­çš„æŸ±å­
        å•è°ƒæ ˆï¼šæ ˆé¡¶åˆ°æ ˆåº•ï¼šä»å¤§åˆ°å°ï¼ˆæ¯æ’å…¥ä¸€ä¸ªæ–°çš„å°æ•°å€¼æ—¶ï¼Œéƒ½è¦å¼¹å‡ºå…ˆå‰çš„å¤§æ•°å€¼ï¼‰
        æ ˆé¡¶ï¼Œæ ˆé¡¶çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³å°†å…¥æ ˆçš„å…ƒç´ ï¼šè¿™ä¸‰ä¸ªå…ƒç´ ç»„æˆäº†æœ€å¤§é¢ç§¯çš„é«˜åº¦å’Œå®½åº¦
        æƒ…å†µä¸€ï¼šå½“å‰éå†çš„å…ƒç´ heights[i]å¤§äºæ ˆé¡¶å…ƒç´ çš„æƒ…å†µ
        æƒ…å†µäºŒï¼šå½“å‰éå†çš„å…ƒç´ heights[i]ç­‰äºæ ˆé¡¶å…ƒç´ çš„æƒ…å†µ
        æƒ…å†µä¸‰ï¼šå½“å‰éå†çš„å…ƒç´ heights[i]å°äºæ ˆé¡¶å…ƒç´ çš„æƒ…å†µ
        '''

        # è¾“å…¥æ•°ç»„é¦–å°¾å„è¡¥ä¸Šä¸€ä¸ª0ï¼ˆä¸42.æ¥é›¨æ°´ä¸åŒçš„æ˜¯ï¼Œæœ¬é¢˜åŸé¦–å°¾çš„ä¸¤ä¸ªæŸ±å­å¯ä»¥ä½œä¸ºæ ¸å¿ƒæŸ±è¿›è¡Œæœ€å¤§é¢ç§¯å°è¯•
        heights.insert(0, 0)
        heights.append(0)
        stack = [0]
        result = 0
        for i in range(1, len(heights)):
            # æƒ…å†µä¸€
            if heights[i] > heights[stack[-1]]:
                stack.append(i)
            # æƒ…å†µäºŒ
            elif heights[i] == heights[stack[-1]]:
                stack.pop()
                stack.append(i)
            # æƒ…å†µä¸‰
            else:
                # æŠ›å‡ºæ‰€æœ‰è¾ƒé«˜çš„æŸ±å­
                while stack and heights[i] < heights[stack[-1]]:
                    # æ ˆé¡¶å°±æ˜¯ä¸­é—´çš„æŸ±å­ï¼Œä¸»å¿ƒéª¨
                    mid_index = stack[-1]
                    stack.pop()
                    if stack:
                        left_index = stack[-1]
                        right_index = i
                        width = right_index - left_index - 1
                        height = heights[mid_index]
                        result = max(result, width * height)
                stack.append(i)
        return result

# å•è°ƒæ ˆç²¾ç®€
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        heights.insert(0, 0)
        heights.append(0)
        stack = [0]
        result = 0
        for i in range(1, len(heights)):
            while stack and heights[i] < heights[stack[-1]]:
                mid_height = heights[stack[-1]]
                stack.pop()
                if stack:
                    # area = width * height
                    area = (i - stack[-1] - 1) * mid_height
                    result = max(area, result)
            stack.append(i)
        return result





```

* []

```go
// > å•è°ƒæ ˆ
func largestRectangleArea(heights []int) int {
 // å£°æ˜maxå¹¶åˆå§‹åŒ–ä¸º0
 max := 0
 // ä½¿ç”¨åˆ‡ç‰‡å®ç°æ ˆ
 stack := make([]int, 0)
 // æ•°ç»„å¤´éƒ¨åŠ å…¥0
 heights = append([]int{0}, heights...)
 // æ•°ç»„å°¾éƒ¨åŠ å…¥0
 heights = append(heights, 0)
 // åˆå§‹åŒ–æ ˆï¼Œåºå·ä»0å¼€å§‹
 stack = append(stack, 0)
 for i := 1; i < len(heights); i++ {
  // ç»“æŸå¾ªç¯æ¡ä»¶ä¸ºï¼šå½“å³å°†å…¥æ ˆå…ƒç´ >topå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å½¢æˆéå•è°ƒé€’å¢çš„è¶‹åŠ¿
  for heights[stack[len(stack)-1]] > heights[i] {
   // mid æ˜¯top
   mid := stack[len(stack)-1]
   // å‡ºæ ˆ
   stack = stack[0 : len(stack)-1]
   // leftæ˜¯topçš„ä¸‹ä¸€ä½å…ƒç´ ï¼Œiæ˜¯å°†è¦å…¥æ ˆçš„å…ƒç´ 
   left := stack[len(stack)-1]
   // é«˜åº¦xå®½åº¦
   tmp := heights[mid] * (i - left - 1)
   if tmp > max {
    max = tmp
   }
  }
  stack = append(stack, i)
 }
 return max
}

```

* []

```javascript
//åŒæŒ‡é’ˆ jsä¸­è¿è¡Œé€Ÿåº¦æœ€å¿«
var largestRectangleArea = function(heights) {
    const len = heights.length;
    const minLeftIndex = new Array(len);
    const maxRigthIndex = new Array(len);
    // è®°å½•æ¯ä¸ªæŸ±å­ å·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
    minLeftIndex[0] = -1; // æ³¨æ„è¿™é‡Œåˆå§‹åŒ–ï¼Œé˜²æ­¢ä¸‹é¢whileæ­»å¾ªç¯
    for(let i = 1; i < len; i++) {
        let t = i - 1;
        // è¿™é‡Œä¸æ˜¯ç”¨ifï¼Œè€Œæ˜¯ä¸æ–­å‘å·¦å¯»æ‰¾çš„è¿‡ç¨‹
        while(t >= 0 && heights[t] >= heights[i]) t = minLeftIndex[t];
        minLeftIndex[i] = t;
    }
    // è®°å½•æ¯ä¸ªæŸ±å­ å³è¾¹ç¬¬ä¸€ä¸ªå°äºè¯¥æŸ±å­çš„ä¸‹æ ‡
    maxRigthIndex[len - 1] = len; // æ³¨æ„è¿™é‡Œåˆå§‹åŒ–ï¼Œé˜²æ­¢ä¸‹é¢whileæ­»å¾ªç¯
    for(let i = len - 2; i >= 0; i--){
        let t = i + 1;
        // è¿™é‡Œä¸æ˜¯ç”¨ifï¼Œè€Œæ˜¯ä¸æ–­å‘å³å¯»æ‰¾çš„è¿‡ç¨‹
        while(t < len && heights[t] >= heights[i]) t = maxRigthIndex[t];
        maxRigthIndex[i] = t;
    }
    // æ±‚å’Œ
    let maxArea = 0;
    for(let i = 0; i < len; i++){
        let sum = heights[i] * (maxRigthIndex[i] - minLeftIndex[i] - 1);
        maxArea = Math.max(maxArea , sum);
    }
    return maxArea;
};

//å•è°ƒæ ˆ
var largestRectangleArea = function(heights) {
    let maxArea = 0;
    const stack = [];
    heights = [0,...heights,0]; // æ•°ç»„å¤´éƒ¨åŠ å…¥å…ƒç´ 0 æ•°ç»„å°¾éƒ¨åŠ å…¥å…ƒç´ 0
    for(let i = 0; i < heights.length; i++){
        if(heights[i] > heights[stack[stack.length-1]]){ // æƒ…å†µä¸‰
            stack.push(i);
        } else if(heights[i] === heights[stack[stack.length-1]]){ // æƒ…å†µäºŒ
            stack.pop(); // è¿™ä¸ªå¯ä»¥åŠ ï¼Œå¯ä»¥ä¸åŠ ï¼Œæ•ˆæœä¸€æ ·ï¼Œæ€è·¯ä¸åŒ
            stack.push(i);
        } else { // æƒ…å†µä¸€
            while(heights[i] < heights[stack[stack.length-1]]){// å½“å‰baræ¯”æ ˆé¡¶barçŸ®
                const stackTopIndex = stack.pop();// æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œå¹¶ä¿å­˜æ ˆé¡¶barçš„ç´¢å¼•
                let w = i - stack[stack.length -1] - 1;
                let h = heights[stackTopIndex]
                // è®¡ç®—é¢ç§¯ï¼Œå¹¶å–æœ€å¤§é¢ç§¯
                maxArea = Math.max(maxArea, w * h);
            }
            stack.push(i);// å½“å‰baræ¯”æ ˆé¡¶baré«˜äº†ï¼Œå…¥æ ˆ
        }
    }
    return maxArea;
};

//å•è°ƒæ ˆ ç®€æ´
var largestRectangleArea = function(heights) {
    let maxArea = 0;
    const stack = [];
    heights = [0,...heights,0]; // æ•°ç»„å¤´éƒ¨åŠ å…¥å…ƒç´ 0 æ•°ç»„å°¾éƒ¨åŠ å…¥å…ƒç´ 0
    for(let i = 0; i < heights.length; i++){ // åªç”¨è€ƒè™‘æƒ…å†µä¸€ å½“å‰éå†çš„å…ƒç´ heights[i]å°äºæ ˆé¡¶å…ƒç´ heights[stack[stack.length-1]]]çš„æƒ…å†µ
        while(heights[i] < heights[stack[stack.length-1]]){// å½“å‰baræ¯”æ ˆé¡¶barçŸ®
            const stackTopIndex = stack.pop();// æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œå¹¶ä¿å­˜æ ˆé¡¶barçš„ç´¢å¼•
            let w = i - stack[stack.length -1] - 1;
            let h = heights[stackTopIndex]
            // è®¡ç®—é¢ç§¯ï¼Œå¹¶å–æœ€å¤§é¢ç§¯
            maxArea = Math.max(maxArea, w * h);
        }
        stack.push(i);// å½“å‰baræ¯”æ ˆé¡¶baré«˜äº†ï¼Œå…¥æ ˆ
    }
    return maxArea;
};
```

* []

```typescript
// > æš´åŠ›æ³•ï¼ˆä¼šè¶…æ—¶ï¼‰ï¼š
function largestRectangleArea(heights: number[]): number {
    let resMax: number = 0;
    for (let i = 0, length = heights.length; i < length; i++) {
        // å·¦å¼€å³å¼€
        let left: number = i - 1,
            right: number = i + 1;
        while (left >= 0 && heights[left] >= heights[i]) {
            left--;
        }
        while (right < length && heights[right] >= heights[i]) {
            right++;
        }
        resMax = Math.max(resMax, heights[i] * (right - left - 1));
    }
    return resMax;
};

// > åŒæŒ‡é’ˆé¢„å¤„ç†ï¼š
function largestRectangleArea(heights: number[]): number {
    const length: number = heights.length;
    const leftHeightDp: number[] = [],
        rightHeightDp: number[] = [];
    leftHeightDp[0] = -1;
    rightHeightDp[length - 1] = length;
    for (let i = 1; i < length; i++) {
        let j = i - 1;
        while (j >= 0 && heights[i] <= heights[j]) {
            j = leftHeightDp[j];
        }
        leftHeightDp[i] = j;
    }
    for (let i = length - 2; i >= 0; i--) {
        let j = i + 1;
        while (j < length && heights[i] <= heights[j]) {
            j = rightHeightDp[j];
        }
        rightHeightDp[i] = j;
    }
    let resMax: number = 0;
    for (let i = 0; i < length; i++) {
        let area = heights[i] * (rightHeightDp[i] - leftHeightDp[i] - 1);
        resMax = Math.max(resMax, area);
    }
    return resMax;
};

// > å•è°ƒæ ˆï¼š
function largestRectangleArea(heights: number[]): number {
    heights.push(0);
    const length: number = heights.length;
    // æ ˆåº•->æ ˆé¡¶ï¼šä¸¥æ ¼å•è°ƒé€’å¢
    const stack: number[] = [];
    stack.push(0);
    let resMax: number = 0;
    for (let i = 1; i < length; i++) {
        let top = stack[stack.length - 1];
        if (heights[top] < heights[i]) {
            stack.push(i);
        } else if (heights[top] === heights[i]) {
            stack.pop();
            stack.push(i);
        } else {
            while (stack.length > 0 && heights[top] > heights[i]) {
                let mid = stack.pop();
                let left = stack.length > 0 ? stack[stack.length - 1] : -1;
                let w = i - left - 1;
                let h = heights[mid];
                resMax = Math.max(resMax, w * h);
                top = stack[stack.length - 1];
            }
            stack.push(i);
        }
    }
    return resMax;
};
```

# å•è°ƒæ ˆåŠ›æ‰£é¢˜ç›®æ€»ç»“

æŒ‰ç…§å¦‚ä¸‹é¡ºåºåˆ·åŠ›æ‰£ä¸Šçš„é¢˜ç›®ï¼Œç›¸ä¿¡ä¼šå¸®ä½ å¿«é€ŸæŒæ¡å„ç±»å•è°ƒæ ˆé¢˜ç›®ã€‚ä»¥ä¸‹æ¯é“é¢˜ç›®åœ¨åŠ›æ‰£é¢˜è§£åŒºéƒ½æœ‰ã€Œä»£ç éšæƒ³å½•ã€çš„é¢˜è§£ã€‚

1. [739.æ¯æ—¥æ¸©åº¦](https://programmercarl.com/0739.æ¯æ—¥æ¸©åº¦.html)
2. [496.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I](https://programmercarl.com/0496.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I.html)
3. [503.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II](https://programmercarl.com/0503.ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II.html)
4. [42.æ¥é›¨æ°´](https://programmercarl.com/0042.æ¥é›¨æ°´.html)
5. [84.æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://programmercarl.com/0084.æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢.html)

**å¦‚æœæ„Ÿè§‰é¢˜è§£å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸è¦åå•¬ç»™ä¸€ä¸ªğŸ‘å§ï¼**
